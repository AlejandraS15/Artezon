{% load static %}
{% block content %}
<div class="agregar-header">
    <a href="/" class="agregar-logo">Artezon</a>
    <nav class="agregar-nav">
        <a href="/">Inicio</a>
        <a href="/vendedores/mis-productos/">Mis productos</a>
        <a href="#" class="active">Editar producto</a>
        <a href="/profile/">Perfil</a>
    </nav>
</div>
<div class="agregar-container">
    <div class="agregar-page-header">
        <h1>Editar Producto</h1>
        <div class="agregar-decorative-line"></div>
        <p>Actualiza los detalles de tu creaci贸n artesanal</p>
    </div>
    <form class="agregar-form" id="editar-producto-form" method="post" enctype="multipart/form-data">
        {% csrf_token %}
        {% for field in form %}
            <div class="agregar-form-group">
                <label class="agregar-form-label">{{ field.label }}</label>
                {% if field.name == "imagen" %}
                    {% if producto.imagen %}
                        <img id="preview-imagen" src="{{ producto.imagen.url }}" alt="Previsualizaci贸n" style="max-width:100%; max-height:200px; margin-top:10px;" />
                        <input type="file" name="imagen" id="id_imagen" class="agregar-form-input mt-2" />
                    {% else %}
                        {{ field }}
                        <img id="preview-imagen" src="#" alt="Previsualizaci贸n" style="display:none; max-width:100%; max-height:200px; margin-top:10px;" />
                    {% endif %}
                {% else %}
                    {{ field }}
                {% endif %}
                {% if field.help_text %}
                    <small class="form-text text-muted">{{ field.help_text }}</small>
                {% endif %}
                {% for error in field.errors %}
                    <div class="agregar-error-message">{{ error }}</div>
                {% endfor %}
            </div>
        {% endfor %}
        <div class="agregar-form-group">
            <button type="button" class="agregar-btn-secondary" style="width:100%;margin-bottom:10px;" onclick="calcularPrecioSugerido()">
                Mostrar precio sugerido
            </button>
            <input type="text" id="precio-sugerido" class="agregar-form-input" placeholder="Precio sugerido" readonly style="display:none;">
        </div>
        <div class="agregar-form-group" style="margin-top:32px;">
            <button type="submit" class="agregar-btn-primary" style="width:100%;">
                Guardar cambios
            </button>
            <a href="{% url 'mis_productos' %}" class="agregar-btn-secondary" style="width:100%;margin-top:10px;">Cancelar</a>
        </div>
    </form>
</div>
<link rel="stylesheet" href="{% static 'css/agregar_producto.css' %}">
<script>
function calcularPrecioSugerido() {
    const material = document.getElementById("id_material")?.value;
    const horas = parseInt(document.getElementById("id_horas")?.value) || 0;
    const experiencia = document.getElementById("id_experiencia")?.value;
    const cantidad_material = parseFloat(document.getElementById("id_cantidad_material")?.value) || 0;

    // Valores por KG
    const material_factor = {
        'algodon': 12000,   // ejemplo: $10.000 por KG
        'lana': 24000,      // ejemplo: $22.000 por KG
        'cuero': 60000,     // ejemplo: $60.000 por KG
    };
    const experiencia_factor = {
        'principiante': 1.0,
        'intermedio': 1.5,
        'experto': 2.0,
    };

    const base = 1000;
    const costo_material = (material_factor[material] || 0) * cantidad_material;
    const precio = base + (horas * 8000) + costo_material * (experiencia_factor[experiencia] || 1);

    const input = document.getElementById("precio-sugerido");
    input.value = "Sugerido: $" + precio.toFixed(2);
    input.style.display = "block";
}

// Previsualizaci贸n de imagen
document.addEventListener("DOMContentLoaded", function() {
    const inputImagen = document.getElementById("id_imagen");
    const preview = document.getElementById("preview-imagen");
    if (inputImagen) {
        inputImagen.addEventListener("change", function() {
            const file = this.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    preview.src = e.target.result;
                    preview.style.display = "block";
                }
                reader.readAsDataURL(file);
            } else {
                preview.src = "#";
                preview.style.display = "none";
            }
        });
    }
});
</script>
{% endblock %}
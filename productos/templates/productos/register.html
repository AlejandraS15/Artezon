{% extends "base.html" %}
{% load static %}
{% block content %}
<div style="display: flex; align-items: center; justify-content: center; min-height: 80vh; width: 100vw;">
<div class="register-container">
    <div class="register-header">
        <h1>√önete a Artezon</h1>
        <div class="decorative-line"></div>
        <p>Crea tu cuenta y comienza a descubrir artesan√≠as √∫nicas</p>
    </div>
    <form class="register-form" id="registerForm" method="POST" action="{% url 'register' %}">
        {% csrf_token %}
        <div class="form-grid">
            <!-- NOMBRE DE USUARIO -->
            <div class="form-group" id="usernameGroup">
                <label class="form-label" for="id_username">Nombre de usuario</label>
                <div class="input-with-icon">
                    <span class="input-icon">üë§</span>
                    <input 
                        type="text" 
                        id="id_username"
                        name="username" 
                        class="form-input" 
                        placeholder="Escribe tu nombre de usuario"
                        required
                        autocomplete="username"
                        value="{{ form.username.value|default:'' }}"
                    >
                </div>
                {% if form.username.errors %}
                    <span class="error-message">{{ form.username.errors.0 }}</span>
                {% else %}
                    <span class="error-message">El nombre de usuario es requerido</span>
                {% endif %}
            </div>
            <!-- CORREO ELECTR√ìNICO -->
            <div class="form-group" id="emailGroup">
                <label class="form-label" for="id_email">Correo electr√≥nico</label>
                <div class="input-with-icon">
                    <span class="input-icon">@</span>
                    <input 
                        type="email" 
                        id="id_email"
                        name="email" 
                        class="form-input" 
                        placeholder="correo@dominio.com"
                        required
                        autocomplete="email"
                        value="{{ form.email.value|default:'' }}"
                    >
                </div>
                {% if form.email.errors %}
                    <span class="error-message">{{ form.email.errors.0 }}</span>
                {% else %}
                    <span class="error-message">Por favor ingresa un correo v√°lido</span>
                {% endif %}
            </div>
            <!-- CONTRASE√ëA -->
            <div class="form-group" id="passwordGroup">
                <label class="form-label" for="id_password1">Contrase√±a</label>
                <div class="password-wrapper">
                    <div class="input-with-icon">
                        <span class="input-icon">üîí</span>
                        <input 
                            type="password" 
                            id="id_password1"
                            name="password1" 
                            class="form-input" 
                            placeholder="Escribe tu contrase√±a"
                            required
                            autocomplete="new-password"
                        >
                        <button type="button" class="toggle-password" onclick="togglePassword('id_password1')" aria-label="Mostrar contrase√±a">
                            üëÅÔ∏è
                        </button>
                    </div>
                </div>
                <div class="password-strength" id="passwordStrength">
                    <div class="strength-bar" id="strengthBar"></div>
                </div>
                <p class="password-hint">M√≠nimo 8 caracteres</p>
                {% if form.password1.errors %}
                    <span class="error-message">{{ form.password1.errors.0 }}</span>
                {% else %}
                    <span class="error-message">La contrase√±a debe tener al menos 8 caracteres</span>
                {% endif %}
            </div>
            <!-- CONFIRMAR CONTRASE√ëA -->
            <div class="form-group" id="confirmPasswordGroup">
                <label class="form-label" for="id_password2">Confirmar contrase√±a</label>
                <div class="password-wrapper">
                    <div class="input-with-icon">
                        <span class="input-icon">üîí</span>
                        <input 
                            type="password" 
                            id="id_password2"
                            name="password2" 
                            class="form-input" 
                            placeholder="Repite tu contrase√±a"
                            required
                            autocomplete="new-password"
                        >
                        <button type="button" class="toggle-password" onclick="togglePassword('id_password2')" aria-label="Mostrar contrase√±a">
                            üëÅÔ∏è
                        </button>
                    </div>
                </div>
                {% if form.password2.errors %}
                    <span class="error-message">{{ form.password2.errors.0 }}</span>
                {% else %}
                    <span class="error-message">Las contrase√±as no coinciden</span>
                {% endif %}
            </div>
        </div>
        <button type="submit" class="submit-btn" id="submitBtn">
            Registrarme
        </button>
        <div class="login-link">
            ¬øYa tienes cuenta? <a href="{% url 'login' %}">Inicia sesi√≥n aqu√≠</a>
        </div>
    </form>
    </div>
</div>
<script>
    // Toggle password visibility
    function togglePassword(inputId) {
        const passwordInput = document.getElementById(inputId);
        const toggleBtn = passwordInput.parentElement.querySelector('.toggle-password');
        if (passwordInput.type === 'password') {
            passwordInput.type = 'text';
            toggleBtn.textContent = 'üôà';
        } else {
            passwordInput.type = 'password';
            toggleBtn.textContent = 'üëÅÔ∏è';
        }
    }
    // Password strength indicator
    const passwordInput = document.getElementById('id_password1');
    const strengthBar = document.getElementById('strengthBar');
    const passwordStrength = document.getElementById('passwordStrength');
    if (passwordInput) {
        passwordInput.addEventListener('input', function() {
            const password = this.value;
            let strength = 0;
            if (password.length >= 8) strength++;
            if (password.match(/[a-z]/) && password.match(/[A-Z]/)) strength++;
            if (password.match(/[0-9]/)) strength++;
            if (password.match(/[^a-zA-Z0-9]/)) strength++;
            strengthBar.className = 'strength-bar';
            passwordStrength.classList.add('show');
            if (strength <= 1) {
                strengthBar.classList.add('strength-weak');
            } else if (strength <= 3) {
                strengthBar.classList.add('strength-medium');
            } else {
                strengthBar.classList.add('strength-strong');
            }
            if (password.length === 0) {
                passwordStrength.classList.remove('show');
            }
        });
    }
    // Form validation
    document.getElementById('registerForm').addEventListener('submit', function(e) {
        let isValid = true;
        // Validate username
        const username = document.getElementById('id_username');
        const usernameGroup = document.getElementById('usernameGroup');
        if (username.value.trim().length < 3) {
            usernameGroup.classList.add('has-error');
            username.classList.add('error');
            isValid = false;
        } else {
            usernameGroup.classList.remove('has-error');
            username.classList.remove('error');
            username.classList.add('success');
        }
        // Validate email
        const email = document.getElementById('id_email');
        const emailGroup = document.getElementById('emailGroup');
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!emailRegex.test(email.value)) {
            emailGroup.classList.add('has-error');
            email.classList.add('error');
            isValid = false;
        } else {
            emailGroup.classList.remove('has-error');
            email.classList.remove('error');
            email.classList.add('success');
        }
        // Validate password
        const password = document.getElementById('id_password1');
        const passwordGroup = document.getElementById('passwordGroup');
        if (password.value.length < 8) {
            passwordGroup.classList.add('has-error');
            password.classList.add('error');
            isValid = false;
        } else {
            passwordGroup.classList.remove('has-error');
            password.classList.remove('error');
            password.classList.add('success');
        }
        // Validate confirm password
        const confirmPassword = document.getElementById('id_password2');
        const confirmPasswordGroup = document.getElementById('confirmPasswordGroup');
        if (confirmPassword.value !== password.value) {
            confirmPasswordGroup.classList.add('has-error');
            confirmPassword.classList.add('error');
            isValid = false;
        } else {
            confirmPasswordGroup.classList.remove('has-error');
            confirmPassword.classList.remove('error');
            confirmPassword.classList.add('success');
        }
        if (!isValid) {
            e.preventDefault();
        } else {
            // Add loading state
            const submitBtn = document.getElementById('submitBtn');
            submitBtn.classList.add('loading');
            submitBtn.textContent = '';
        }
    });
    // Remove error on input
    document.querySelectorAll('.form-input').forEach(input => {
        input.addEventListener('input', function() {
            this.classList.remove('error');
            this.closest('.form-group').classList.remove('has-error');
        });
    });
    // Real-time password match validation
    const confirmPasswordInput = document.getElementById('id_password2');
    if (confirmPasswordInput) {
        confirmPasswordInput.addEventListener('input', function() {
            const password = document.getElementById('id_password1').value;
            const confirmPasswordGroup = document.getElementById('confirmPasswordGroup');
            if (this.value === password && this.value.length > 0) {
                this.classList.remove('error');
                this.classList.add('success');
                confirmPasswordGroup.classList.remove('has-error');
            } else if (this.value.length > 0) {
                this.classList.add('error');
                this.classList.remove('success');
            }
        });
    }
</script>
{% endblock %}

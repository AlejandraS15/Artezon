{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Productos</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    /* estilos mínimos para ver bonito sin frameworks */
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; margin: 1.5rem; }
    .grid { display: grid; gap: 1rem; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); }
    .card { border: 1px solid #ddd; border-radius: 12px; padding: 1rem; }
    .row { display: flex; gap: .5rem; align-items: center; flex-wrap: wrap; }
    .filters { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: .75rem; margin-bottom: 1rem; }
    input, select, button { padding: .5rem; border-radius: 8px; border: 1px solid #ccc; width: 100%; }
    .pagination a, .pagination span { margin-right: .5rem; }
  </style>
</head>
<body>
  <h1>Productos disponibles</h1>

  <form method="get" class="filters">
    <div>
      <label>Material</label>
      <select name="material">
        <option value="">Todos</option>
        {% for m in materials %}
          <option value="{{ m }}" {% if current_filters.material == m %}selected{% endif %}>{{ m }}</option>
        {% endfor %}
      </select>
    </div>
    <div>
      <label>Color</label>
      <select name="color">
        <option value="">Todos</option>
        {% for c in colors %}
          <option value="{{ c }}" {% if current_filters.color == c %}selected{% endif %}>{{ c }}</option>
        {% endfor %}
      </select>
    </div>
    <div>
      <label>Precio mínimo</label>
      <input type="number" name="price_min" step="0.01" value="{{ current_filters.price_min }}">
    </div>
    <div>
      <label>Precio máximo</label>
      <input type="number" name="price_max" step="0.01" value="{{ current_filters.price_max }}">
    </div>
    <div class="row">
      <button type="submit">Filtrar</button>
      <a href="{% url 'productos:list' %}">Limpiar</a>
    </div>
  </form>

  <section class="grid">
    {% for p in products %}
      <article class="card">
        <h3>{{ p.name }}</h3>
        <p>{{ p.description|truncatechars:100 }}</p>
        <p><strong>Material:</strong> {{ p.material }} | <strong>Color:</strong> {{ p.color }}</p>
        <p><strong>Precio:</strong> ${{ p.price }}</p>
        <p><small>Stock: {{ p.stock }}</small></p>
      </article>
    {% empty %}
      <p>No hay productos que coincidan con los filtros.</p>
    {% endfor %}
  </section>

  {% if is_paginated %}
  <nav class="pagination" aria-label="Paginación">
    {% if page_obj.has_previous %}
      <a href="?page={{ page_obj.previous_page_number }}&material={{ current_filters.material }}&color={{ current_filters.color }}&price_min={{ current_filters.price_min }}&price_max={{ current_filters.price_max }}">Anterior</a>
    {% endif %}
    <span>Página {{ page_obj.number }} de {{ page_obj.paginator.num_pages }}</span>
    {% if page_obj.has_next %}
      <a href="?page={{ page_obj.next_page_number }}&material={{ current_filters.material }}&color={{ current_filters.color }}&price_min={{ current_filters.price_min }}&price_max={{ current_filters.price_max }}">Siguiente</a>
    {% endif %}
  </nav>
  {% endif %}
</body>
</html>
